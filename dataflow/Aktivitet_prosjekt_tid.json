{
	"name": "Aktivitet_prosjekt_tid",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "AzureSqlTable1",
						"type": "DatasetReference"
					},
					"name": "source1"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ASQL_Aktivitet_prosjekt_tid",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "Removecolumns"
				},
				{
					"name": "Filter1"
				},
				{
					"name": "Window1"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "Select1"
				},
				{
					"name": "StartDatetimetoDatetime"
				},
				{
					"name": "Sort1"
				}
			],
			"script": "source(output(\n\t\tAmount as double,\n\t\tApproved as string,\n\t\tApprovedByName as string,\n\t\tApprovedDateTime as string,\n\t\tBreakQt as string,\n\t\tBreakUnplanned as integer,\n\t\tChapterId as string,\n\t\tCompanyName as string,\n\t\tCompanyOrgNr as string,\n\t\tCostAmount as double,\n\t\tCostPriceBase as integer,\n\t\tDescription as string,\n\t\tDescriptionInternal as string,\n\t\tDinnerSkipped as string,\n\t\tDinnerSubtracted as string,\n\t\tEmployeeNumber as string,\n\t\tExternalId as string,\n\t\tPieceWorkId as string,\n\t\tExternalDim01 as string,\n\t\tId as string,\n\t\tLocked as string,\n\t\tLockedByName as string,\n\t\tLockedDateTime as string,\n\t\tLunchSkipped as string,\n\t\tLunchSubtracted as string,\n\t\tPrice as double,\n\t\tPrimaryResourceName as string,\n\t\tProjectCompanyName as string,\n\t\tProjectName as string,\n\t\tProjectNumber as string,\n\t\tProjectCompanyId as string,\n\t\tQty as double,\n\t\tResourceName as string,\n\t\tResourceNumber as string,\n\t\tResourceTypeName as string,\n\t\tStartDateTime as string,\n\t\tStopDateTime as string,\n\t\tTaskName as string,\n\t\tTaskNameLong as string,\n\t\tUnitName as string,\n\t\tUnitPrice as integer,\n\t\tUnitQty as integer,\n\t\tUserBirthDate as string,\n\t\tUserName as string,\n\t\tWorkShiftSettingName as string,\n\t\tExternalProjectNumber as string,\n\t\tMachineEmissionClass as string,\n\t\tStatus as string,\n\t\tUserId as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> source1\nStartDatetimetoDatetime select(mapColumn(\n\t\tId,\n\t\tProjectNumber,\n\t\tResourceNumber,\n\t\tStartDateTime,\n\t\tTaskNameLong\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Removecolumns\nSort1 filter(ResourceNumber != 'null' && ResourceNumber != '') ~> Filter1\nFilter1 window(asc(ResourceNumber, true),\n\tasc(StartDateTime, true),\n\tNextStartDateTime = lead(StartDateTime,1),\n\t\tNextResourceNumber = lead(ResourceNumber,1)) ~> Window1\nWindow1 derive(EndDateTime = iif(ResourceNumber == NextResourceNumber, NextStartDateTime - seconds(1), toTimestamp('2999-12-31 00:00:00'))) ~> DerivedColumn1\nDerivedColumn1 select(mapColumn(\n\t\tProjectNumber,\n\t\tResourceNumber,\n\t\tStartDateTime,\n\t\tTaskNameLong,\n\t\tEndDateTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nsource1 derive(StartDateTime = toTimestamp(StartDateTime, 'yyyy-MM-dd\\'T\\'HH:mm:ss')) ~> StartDatetimetoDatetime\nRemovecolumns sort(asc(ResourceNumber, true),\n\tasc(StartDateTime, true)) ~> Sort1\nSelect1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tProjectNumber as string,\n\t\tTaskNameLong as string,\n\t\tResourceNumber as string,\n\t\tStartDateTime as timestamp,\n\t\tEndDateTime as timestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tpreSQLs:['TRUNCATE TABLE dbo.Aktivitet_prosjekt_tid'],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tProjectNumber,\n\t\tTaskNameLong,\n\t\tResourceNumber,\n\t\tStartDateTime,\n\t\tEndDateTime\n\t)) ~> sink1"
		}
	}
}