{
	"name": "FullMachine",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "VolvoCE_Fleet_SQL",
						"type": "DatasetReference"
					},
					"name": "VolvoCE"
				},
				{
					"dataset": {
						"referenceName": "SQLMachine",
						"type": "DatasetReference"
					},
					"name": "Machine"
				},
				{
					"dataset": {
						"referenceName": "VolvoTrucks",
						"type": "DatasetReference"
					},
					"name": "VolvoTruck"
				},
				{
					"dataset": {
						"referenceName": "Codatahost_trans_SQL",
						"type": "DatasetReference"
					},
					"name": "CoDataHost"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "MergeMachine",
						"type": "DatasetReference"
					},
					"name": "SinkMachineMerge"
				}
			],
			"transformations": [
				{
					"name": "VolvoCEMachine"
				},
				{
					"name": "VolvoTruckMachine"
				},
				{
					"name": "SelectVolvoTruck"
				},
				{
					"name": "SelectVolvoCE"
				},
				{
					"name": "Union"
				}
			],
			"script": "source(output(\n\t\tEquimentHeader_OEMName as string,\n\t\tEquimentHeader_Model as string,\n\t\tEquimentHeader_SerialNumber as string,\n\t\tLocation_lat as string,\n\t\tLocation_lon as string,\n\t\tLocation_datetime as string,\n\t\tEngineStatus_number as string,\n\t\tEngineStatus_running as string,\n\t\tEngineStatus_datetime as string,\n\t\tversion as string,\n\t\tsnapshotTime as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> VolvoCE\nsource(output(\n\t\t{ResourceExternalRefs.ResourceNumber} as string,\n\t\t{ResourceExternalRefs.ExternalRefType} as string,\n\t\t{ResourceExternalRefs.ExternalRefValue} as string,\n\t\t{ResourceExternalRefs.Id} as string,\n\t\t{ResourceExternalRefs.CompanyId} as string,\n\t\t{ResourceExternalRefs.CompanyIds} as string,\n\t\t{ResourceExternalRefs.RecVersion} as integer,\n\t\tCompanyName as string,\n\t\tCanEdit as string,\n\t\tShowPrice as string,\n\t\tResourceExternalRefs as string,\n\t\tResourceNameFull as string,\n\t\tCapacityUnitId as string,\n\t\tCapacityRatioRock as double,\n\t\tCapacityRatioSoil as double,\n\t\tCapacityRatioClay as double,\n\t\tMeasureTon as string,\n\t\tFuelType as integer,\n\t\tFuelCapacity as integer,\n\t\tFuelConsumptionHour as double,\n\t\tFuelConsumptionCalculated as double,\n\t\tFuelStatus as double,\n\t\tFuelLastRefill as string,\n\t\tCostVariable as double,\n\t\tCostPriceCalculated as double,\n\t\tCostCalcDate as string,\n\t\tRunCostCalculation as string,\n\t\tCostPrice as double,\n\t\tMeasureTrips as string,\n\t\tPrice as double,\n\t\tAnnualInspectedDate as string,\n\t\tInsuranceExpiryDate as string,\n\t\tBuildYear as integer,\n\t\tEmissionClass as string,\n\t\tPurchasedDate as string,\n\t\tHourMeterInitial as integer,\n\t\tHourMeter as double,\n\t\tServiceDate as string,\n\t\tServiceHour as integer,\n\t\tServiceHourDueWarning as integer,\n\t\tServiceHourInterval as integer,\n\t\tSerialNumber as string,\n\t\tEngineNumber as string,\n\t\tRegistrationNumber as string,\n\t\tMachineId as string,\n\t\t{Type.TypeId} as string,\n\t\t{Type.Description} as string,\n\t\t{Type.BaseType} as integer,\n\t\t{Type.IsLoader} as string,\n\t\t{Type.IsDumper} as string,\n\t\t{Type.Id} as string,\n\t\t{Type.CompanyId} as integer,\n\t\t{Type.RecVersion} as integer,\n\t\tResourceNumber as string,\n\t\tDescription as string,\n\t\tProjIdCurrent as string,\n\t\tLocationText as string,\n\t\tGPSLocation as string,\n\t\tResponsibleId as string,\n\t\tWeight as double,\n\t\tCapacity as double,\n\t\tGeoCoordinate as string,\n\t\tAvatarImageId as string,\n\t\tAllowMultiTrans as string,\n\t\tNote as string,\n\t\tEquipmentTrainingEquipmentRef as string,\n\t\tActive as string,\n\t\tModifiedAt as string,\n\t\tModifiedByUserId as string,\n\t\tCreatedAt as string,\n\t\tCreatedByUserId as string,\n\t\tId as string,\n\t\tCompanyId as integer,\n\t\tRecVersion as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> Machine\nsource(output(\n\t\tvin as string,\n\t\tcustomerVehicleName as string,\n\t\tbrand as string,\n\t\tproductionDateday as string,\n\t\tproductionDatemonth as string,\n\t\tproductionDateyear as string,\n\t\ttype as string,\n\t\tmodel as string,\n\t\t{emissionLevel } as string,\n\t\tvolvoGroupVehiclecountryOfOperation as string,\n\t\tvolvoGroupVehicledeliveryDate as string,\n\t\tvolvoGroupVehicleregistrationNumber as string,\n\t\tvolvoGroupVehicleroadCondition as string,\n\t\tvolvoGroupVehicletransportCycle as string,\n\t\tvolvoGroupVehicleconnectedServices0 as string,\n\t\tvolvoGroupVehicleconnectedServices1 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> VolvoTruck\nsource(output(\n\t\tCardholderFirstName as string,\n\t\tCardholderLastName as string,\n\t\tCardSeriesDisplayName as string,\n\t\tCardType as string,\n\t\tCompanyTraceNo as string,\n\t\tConsumption as string,\n\t\tCustomerNo as string,\n\t\tExportBatchNo as string,\n\t\tExportBatchNoFleet as string,\n\t\tForeignSiteID as string,\n\t\tForeignSiteInfo as string,\n\t\tInvoiceDate as string,\n\t\tInvoiceNo as string,\n\t\tInvoiceSubTotalWithVAT as string,\n\t\tInvoiceUnitPrice as string,\n\t\tOdometerValue as string,\n\t\tPAN as string,\n\t\tProductPartNo as string,\n\t\tProductSystemProductNo as string,\n\t\tPumpAmount as string,\n\t\tPumpUnitPrice as string,\n\t\tQuantity as string,\n\t\tTrip as string,\n\t\tServerSubTotal as string,\n\t\tServerTimestamp as timestamp,\n\t\tServerUnitPrice as string,\n\t\tSiteName as string,\n\t\tSiteNo as string,\n\t\tStockTankNo as string,\n\t\tTerminalNo as string,\n\t\tTerminalTimestamp as timestamp,\n\t\tTerminalTraceNo as string,\n\t\tVehicleNo as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> CoDataHost\nVolvoCE, Machine join(EquimentHeader_SerialNumber == SerialNumber,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> VolvoCEMachine\nVolvoTruck, Machine join(vin == EngineNumber,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> VolvoTruckMachine\nVolvoTruckMachine select(mapColumn(\n\t\tName = brand,\n\t\tModel = model,\n\t\tSerialNumber = vin,\n\t\tResourceNameFull,\n\t\tResourceNumber\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectVolvoTruck\nVolvoCEMachine select(mapColumn(\n\t\tName = EquimentHeader_OEMName,\n\t\tModel = EquimentHeader_Model,\n\t\tSerialNumber = EquimentHeader_SerialNumber,\n\t\tResourceNameFull,\n\t\tResourceNumber\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectVolvoCE\nSelectVolvoCE, SelectVolvoTruck union(byName: true)~> Union\nUnion sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tOEMName as string,\n\t\tModel as string,\n\t\tSerialNumber as string,\n\t\tResourceNameFull as string,\n\t\tResourceNumber as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tpreSQLs:['TRUNCATE TABLE MergeMachine'],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> SinkMachineMerge"
		}
	}
}